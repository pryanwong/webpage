function textChangedEvent(o){$("#saveMessage").text("Changes Made, Save Pending..."),log.debug("text:changed",o.target,o),onSave()}function objectDeletedEvent(o){$("#saveMessage").text("Changes Made, Save Pending..."),log.debug("lineDeletedEvent",o.target,o),onSave()}function loadCanvasDrawing(o){""!=o&&(log.debug("data_drawing not blank"),canvas.loadFromJSON(o,function(){canvas.renderAll.bind(canvas);var o=canvas.getObjects().map(function(o){return o.set("active",!1)});log.debug("Entering loop for objects"),log.debug("Loop size: ",o.length);var e=0,n=0;for(i=0;i<o.length;i++)log.debug("Objs Type: ",o[i].type),o[i].id=n,"customline"==o[i].type&&(o[i].hasControls=!1,console.log("customline: ",o[i]),console.log("Item Id of line set to: ",o[i].getObjId()),canvas.forEachObject(function(s){log.debug("Object Type: ",s.type),"circlezero"!=s.type&&"circleone"!=s.type||(log.debug("circleProspect.belongsTo: ",s.belongsTo),log.debug("objs[1].objId: ",o[i].objId)),"circlezero"==s.type&&s.belongsTo==o[i].objId&&(s.hasBorders=s.hasControls=!1,s.line=o[i],s.belongsTo=n,o[i].cone=s,s.set("hoverCursor","crosshair"),console.log("found circlezero"),e+=1),"circleone"==s.type&&s.belongsTo==o[i].objId&&(s.hasBorders=s.hasControls=!1,s.line=o[i],s.belongsTo=n,o[i].ctwo=s,s.set("hoverCursor","crosshair"),console.log("found circleone"),e+=1),2==e&&(console.log("objId: ",o[i].get("objId")),o[i].setObjId(n),n+=1,o[i].cone.id=n,n+=1,o[i].ctwo.id=n,e=0)}),o[i].on("mousedown",function(o,e){lineDown(o,e)})),"customlinearrow"==o[i].type&&(o[i].hasControls=!1,console.log("customline: ",o[i]),console.log("Item Id of line set to: ",o[i].getObjId()),canvas.forEachObject(function(s){log.debug("Object Type: ",s.type),"carrow"!=s.type&&"conearrow"!=s.type||(log.debug("circleProspect.belongsTo: ",s.belongsTo),log.debug("objs[1].objId: ",o[i].objId)),"conearrow"==s.type&&s.belongsTo==o[i].objId&&(s.hasBorders=s.hasControls=!1,s.line=o[i],s.belongsTo=n,o[i].conearrow=s,s.set("hoverCursor","crosshair"),console.log("found conearrow"),e+=1),"carrow"==s.type&&s.belongsTo==o[i].objId&&(s.hasBorders=s.hasControls=!1,s.line=o[i],s.belongsTo=n,o[i].carrow=s,s.set("hoverCursor","crosshair"),console.log("found carrow"),e+=1),2==e&&(console.log("objId: ",o[i].get("objId")),o[i].setObjId(n),n+=1,o[i].conearrow.id=n,n+=1,o[i].carrow.id=n,e=0)}),o[i].on("mousedown",function(o,e){customlinearrow.lineArrowDown(o,e)})),"customlinetwoarrow"==o[i].type&&(o[i].hasControls=!1,console.log("customline: ",o[i]),console.log("Item Id of line set to: ",o[i].getObjId()),canvas.forEachObject(function(s){log.debug("Object Type: ",s.type),"carrow"!=s.type&&"carrowtwo"!=s.type||(log.debug("circleProspect.belongsTo: ",s.belongsTo),log.debug("objs[1].objId: ",o[i].objId)),"carrowtwo"==s.type&&s.belongsTo==o[i].objId&&(s.hasBorders=s.hasControls=!1,s.line=o[i],s.belongsTo=n,o[i].carrowtwo=s,s.set("hoverCursor","crosshair"),console.log("found carrowtwo"),e+=1),"carrow"==s.type&&s.belongsTo==o[i].objId&&(s.hasBorders=s.hasControls=!1,s.line=o[i],s.belongsTo=n,o[i].carrow=s,s.set("hoverCursor","crosshair"),console.log("found carrow"),e+=1),2==e&&(console.log("objId: ",o[i].get("objId")),o[i].setObjId(n),n+=1,o[i].carrowtwo.id=n,n+=1,o[i].carrow.id=n,e=0)}),o[i].on("mousedown",function(o,e){lineArrowTwoDown(o,e)})),n+=1;canvas.renderAll(),backgroundImageVal="",canvas.hasOwnProperty("backgroundImage")&&canvas.backgroundImage.hasOwnProperty("src")&&(backgroundImageVal=canvas.backgroundImage.src),log.debug("BackgroundImage Loc: ",backgroundImageVal),backgroundExists(backgroundImageVal)},postProcessLoading))}function checkBackgroundFileExists(o){log.info("Entering checkBackgroundFileExists"),log.debug(o),$.ajax({url:o,type:"HEAD",error:function(){return log.debug("In Error Function checkBackgroundFileExists"),log.debug("Background File Not Found"),!1},success:function(){return log.debug("In success Function checkBackgroundFileExists"),log.debug("Background File Exists"),!0}}),log.info("Leaving checkBackgroundFileExists")}var onSave=debounce(function(){log.info("Entering onSave"),modified=!0,$(".saveMessage").text("Save In Progress..."),objects=canvas.getObjects();var o=objects.length;log.debug("Number of objects to process: ",o),console.log("Number of objects to process: ",o),canvas.renderAll();var e=$('meta[name="csrf-token"]').attr("content");canvas.backgroundColor="";var n={company_id:company_id,user_id:user_id,id:drawing_id,authenticity_token:e,png:"",drawing:canvas};log.trace(n);var s="/companies/"+company_id+"/users/"+user_id+"/drawings/"+drawing_id+".json";$.ajax({url:s,type:"patch",dataType:"json",contentType:"application/json",data:JSON.stringify(n),timeout:3e3,complete:function(){},success:function(o){textMsg=JSON.parse(o[0]),console.log("Text Msg: ",textMsg),$("#saveMessage").text(textMsg[0]),loadVersionsIntoPanel(o[1])},error:function(o,e){msg="Error: "+e,$("#saveMessage").text(msg)}}),log.info("Leaving onSave")},3e3);