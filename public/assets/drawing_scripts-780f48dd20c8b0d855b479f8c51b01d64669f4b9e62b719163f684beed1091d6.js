function modernizerFunction(e,n){if(log.info("Entering  modernizerFunction"),e.draganddrop){var t=n.querySelectorAll("#images img");[].forEach.call(t,function(e){e.addEventListener("dragstart",handleDragStart,!1),e.addEventListener("dragend",handleDragEnd,!1)});var o=n.getElementById("canvas-container");o.addEventListener("dragenter",handleDragEnter,!1),o.addEventListener("dragover",handleDragOver,!1),o.addEventListener("dragleave",handleDragLeave,!1),o.addEventListener("drop",handleDrop,!1)}else alert("This browser doesn't support the HTML5 Drag and Drop API.");log.info("Leaving  modernizerFunction")}function GetDebugParameter(e){log.info("Entering  GetDebugParameter");var n=window.location.hash;if(log.debug("sPageURL:"),log.debug(n),n=n.split("?"),!(n.length>1))return log.info("Leaving GetDebugParameter returning false"),!1;var t=n[1].split("&");log.debug("sURLVariables:"),log.debug(t);for(var o=0;o<t.length;o++){var a=t[o].split("=");if(log.debug("sParameterName:"),log.debug(a),a[0]==e)return log.debug("sParameterName[1]:"),log.debug(a[1]),log.info("Leaving GetDebugParameter"),a[1]}}function objectBoundaryCheck(e){if(log.info("Entering  objectBoundaryCheck"),e.target.setCoords(),log.debug("Checking to see if the end points of a line are being dragged "),"circle0"!=e.target.type&&"circle1"!=e.target.type){var n=e.target,t=e.target.getBoundingRect().top+e.target.getBoundingRect().height,o=e.target.getBoundingRect().left+e.target.getBoundingRect().width,a=n.getBoundingRect(),i=-(a.left-n.left),c=-(a.top-n.top);bounds={tl:{x:0,y:0},br:{x:canvas.width,y:canvas.height}},log.debug("Checking to see if we hit the top-left corner"),(e.target.getBoundingRect().top<=bounds.tl.y||e.target.getBoundingRect().left<=bounds.tl.x)&&(log.debug("hit the top-left corner"),e.target.setTop(Math.max(e.target.top,c)),e.target.left=Math.max(e.target.left,i),e.target.setCoords(),canvas.renderAll()),log.debug("Checking to see if we hit the bot-right corner"),(t>=bounds.br.y||o>=bounds.br.x)&&(t>=bounds.br.y&&(e.target.angle>=270&&e.target.angle<360?e.target.top=bounds.br.y-e.target.getBoundingRect().height+c:e.target.angle>=90&&e.target.angle<=180?(e.target.top=bounds.br.y-e.target.getBoundingRect().height+c,log.debug("Calculated Top: "+(bounds.br.y-e.target.getBoundingRect().height+c))):e.target.angle>180&&e.target.angle<270?e.target.top=bounds.br.y-e.target.getBoundingRect().height+c:e.target.angle>=0&&e.target.angle<90&&(e.target.top=bounds.br.y-e.target.getBoundingRect().height+c)),o>=bounds.br.x&&(e.target.angle>=270&&e.target.angle<360?e.target.left=bounds.br.x-e.target.getBoundingRect().width:e.target.angle>=90&&e.target.angle<=180?e.target.left=bounds.br.x:e.target.angle>180&&e.target.angle<270?e.target.left=bounds.br.x-e.target.getBoundingRect().width+i:e.target.angle>=0&&e.target.angle<90&&(e.target.left=bounds.br.x-e.target.getBoundingRect().width+i)),n.setCoords())}log.info("Leaving objectBoundaryCheck")}function boundaryInspectorCircle(e){log.info("Entering boundaryInspectorCircle"),e.target.setCoords();var n=e.target;bounds={tl:{x:0,y:0},br:{x:canvas.width,y:canvas.height}},"circle1"!=n.type&&"circle0"!=n.type||(n.top<bounds.tl.y||n.left<bounds.tl.x?(e.target.setTop(Math.max("0",e.target.top)),e.target.left=Math.max("0",e.target.left)):(n.top+2*n.radius>bounds.br.y||n.left+2*n.radius>bounds.br.x)&&(e.target.setTop(Math.min(bounds.br.y,e.target.top+2*n.radius)),e.target.left=Math.min(bounds.br.x,e.target.left+2*n.radius)),"circle1"==n.type?n.line&&n.line.set({x1:n.line.c1.left,y1:n.line.c1.top,x2:n.left,y2:n.top}):n.line&&n.line.set({x1:n.left,y1:n.top,x2:n.line.c2.left,y2:n.line.c2.top}),n.line.setCoords(),e.target.setCoords(),canvas.renderAll()),log.info("Leaving boundaryInspectorCircle")}function objectResize(e){log.info("Entering objectResize"),"circle"==e.target.type?(newWidth=e.target.width*e.target.scaleX,newRadius=e.target.radius*e.target.scaleX,e.target.set({width:newWidth,radius:newRadius,height:newWidth,scaleX:1,scaleY:1})):"ellipse"==e.target.type?(newWidth=e.target.width*e.target.scaleX,newHeight=e.target.height*e.target.scaleY,newRadiusX=newWidth/2,newRadiusY=newHeight/2,e.target.set({rx:newRadiusX,ry:newRadiusY,scaleX:1,scaleY:1})):"rect"==e.target.type&&(newWidth=e.target.width*e.target.scaleX,newHeight=e.target.height*e.target.scaleY,e.target.set({height:newHeight,width:newWidth,scaleX:1,scaleY:1})),objectBoundaryCheck(e),log.info("Leaving objectResize")}function selectionCleared(){log.info("Entering selectionCleared"),lineActive=!0,lineSelected=!1,log.debug("lineActive: ",lineActive),log.debug("lineSelected: ",lineSelected),log.info("Leaving selectionCleared")}function mouseDown(){log.info("Entering mouseDown"),$("#glossymenu").remove(),contextmenuon=!1,log.debug("contextmenuon: ",contextmenuon),log.info("Leaving mouseDown")}function objectSelected(e){log.info("Entering objectSelected"),activeObject=!0,activeObjectVal=e.target;e.target.get("type");log.trace("activeObject: ",activeObject),log.trace("activeObjectVal: ",activeObjectVal),"line"==e.target.type&&(log.debug("Line Selected "),newGroup=new fabric.Group,newGroup.addWithUpdate(e.target.c1),newGroup.addWithUpdate(e.target.c2),newGroup.addWithUpdate(e.target),newGroup.type="lineGroup",newGroup.hasControls=!1,newGroup.id=itemId,itemId+=1,canvas.add(newGroup),e.target.c1.remove(),e.target.c2.remove(),e.target.remove(),newGroup.on("mousedown",function(e,n){lineDown(e,n)})),lineSelected=!0,log.info("Leaving objectSelected")}function mouseOut(e){if(log.info("Entering mouseOut"),e.target.setOpacity(1),canvas.renderAll(),"lineGroup"==e.target.type&&lineActive){var n=e.target._objects;e.target._restoreObjectsState(),searchId=getItemIndex(e.target),canvas.setActiveObject(canvas.item(searchId)),canvas.getActiveGroup()?(canvas.getActiveGroup().forEachObject(function(e){canvas.remove(e)}),canvas.discardActiveGroup().renderAll()):canvas.remove(canvas.getActiveObject());for(var t=0;t<n.length;t++)n[t].hasBorders=n[t].hasControls=!1,canvas.add(n[t]);n[2].c1=n[0],n[2].c2=n[1],n[0].bringToFront(),n[1].bringToFront(),n[2].sendBackwards(),canvas.renderAll(),n[2].on("mousedown",function(e,n){lineDown(e,n)})}log.info("Leaving mouseOut")}function mouseOver(e){log.info("Entering mouseOver"),log.debug("Set Opacity to 0.5"),e.target.setOpacity(.5),activeObjectVal=e.target,e.target.type&&"line"==e.target.type&&(log.debug("Target is line"),searchId=getItemIndex(e.target),log.trace(e.target),canvas.setActiveObject(canvas.item(searchId))),log.info("Leaving mouseOver")}function postProcessLoading(e,n){log.info("Entering postProcessLoading"),"custom-image"==n.type&&(log.debug("Processing custom-image"),n.on("mousedown",function(e,n){imageDown(e,n)})),"circle"==n.type&&(log.debug("Processing circle"),n.fill=void 0,n.on("mousedown",function(e,n){circleDown(e,n)})),"ellipse"==n.type&&(log.debug("Processing ellipse"),n.fill=void 0,n.on("mousedown",function(e,n){ellipseDown(e,n)})),"rect"==n.type&&(log.debug("Processing rect"),n.fill=void 0,n.on("mousedown",function(e,n){rectangleDown(e,n)})),"line"==n.type&&(log.debug("Processing line"),n.objId=objId_var,n.on("mousedown",function(e,n){lineDown(e,n)})),"i-text"==n.type&&(log.debug("Processing i-text"),n.on("mousedown",function(e,n){textDown(e,n)})),log.info("Leaving postProcessLoading")}function onSave(e,n,t){log.info("Entering onSave"),$(".spinner").show(),objects=canvas.getObjects();canvas.backgroundImage;""===canvas.background&&(canvas.backgroundImage="",log.debug("Setting background image to blank"));var o=objects.length;for(log.debug("Number of objects to process: ",o),index=o-1;index>-1;index--){if("lineGroup"==objects[index].type){log.debug("Processing a line object");var a=objects[index]._objects;objects[index]._restoreObjectsState(),canvas.remove(objects[index]),canvas.add(a[2])}"circle0"!=objects[index].type&&"circle1"!=objects[index].type||(log.debug("Removing circles associated with a line group"),canvas.remove(objects[index]))}var i=$('meta[name="csrf-token"]').attr("content");canvas.backgroundColor="#FFFFFF";var c=canvas.toDataURL("png");canvas.backgroundColor="";var r={company_id:e,user_id:n,id:t,authenticity_token:i,png:c,drawing:canvas},g="/companies/"+e+"/users/"+n+"/drawings/"+t+".json";$.ajax({url:g,type:"patch",dataType:"json",contentType:"application/json",data:JSON.stringify(r),timeout:3e3,complete:function(){$(".spinner").fadeOut(400)},success:function(){},error:function(e,n){alert(n)}}),canvas.renderAll(),log.info("Leaving onSave")}function handleDragStart(){log.info("Entering handleDragStart"),[].forEach.call(images,function(e){e.classList.remove("img_dragging")}),this.classList.add("img_dragging"),log.info("Leaving handleDragStart")}function makeLine(e,n){return log.info("Entering makeLine"),new fabric.Line(e,{fill:"red",stroke:"red",strokeWidth:5,selectable:!0,objId:n,perPixelTargetFind:!0})}function makeCircleShape(e){return log.info("Entering makeCircleShape"),new fabric.Circle({top:e[1],left:e[0],radius:15,fill:void 0,stroke:"red",lockUniScaling:!0,hasRotatingPoint:!1,strokeWidth:5})}function makeEllipseShape(e){return log.info("Entering makeEllipseShape"),new fabric.Ellipse({top:e[1],left:e[0],rx:15,ry:7,fill:void 0,stroke:"red",lockUniScaling:!1,hasRotatingPoint:!0,strokeWidth:5})}function makeRectangleShape(e){return log.info("Entering makeRectangleShape"),new fabric.Rect({top:e[1],left:e[0],width:67,height:45,fill:void 0,stroke:"red",hasRotatingPoint:!0,strokeWidth:5})}function activateColorPicker(){log.info("Entering activateColorPicker");canvas.getActiveObject();document.getElementById("myColor").color.showPicker(),log.info("Leaving activateColorPicker")}function colorPickerChange(e){log.info("Entering colorPickerChange"),log.debug("newLineColor: ",e),activeObjectVal&&(log.trace("activeObjectVal: ",activeObjectVal),activeObjectVal.type&&(log.trace("activeObjectVal.type: ",activeObjectVal.type),"line"==activeObjectVal.type&&(log.debug("colorPickerChange on line type"),activeObjectVal.fill=e,activeObjectVal.stroke=e),"lineGroup"==activeObjectVal.type&&(log.debug("colorPickerChange on lineGroup type"),activeObjectVal._objects[2].stroke=e),"circle"==activeObjectVal.type&&(log.debug("colorPickerChange on circle type"),activeObjectVal.stroke=e),"ellipse"==activeObjectVal.type&&(log.debug("colorPickerChange on ellipse type"),activeObjectVal.stroke=e),"rect"==activeObjectVal.type&&(log.debug("colorPickerChange on rect type"),activeObjectVal.stroke=e),"i-text"==activeObjectVal.type&&(log.debug("colorPickerChange on i-text type"),activeObjectVal.stroke=e))),canvas.renderAll(),log.info("Leaving colorPickerChange")}function makeCircle(e){log.info("Entering makeCircle");var n=new fabric.Circle({left:e.get("x1"),top:e.get("y1"),strokeWidth:2,radius:5,fill:"#fff",stroke:"#666",belongsTo:e.objId,type:"circle0"});n.hasControls=n.hasBorders=!1,n.visible=!0,n.hoverCursor="crosshair";var t=new fabric.Circle({left:e.get("x2"),top:e.get("y2"),strokeWidth:2,radius:5,fill:"#fff",stroke:"#666",belongsTo:e.objId,type:"circle1"});t.hasControls=t.hasBorders=!1,t.visible=!0,t.hoverCursor="crosshair",n.belongsTo=e.objId,t.belongsTo=e.objId,n.line=e,t.line=e,e.c1=n,e.c2=t;var o=new Array(n,t);return log.info("Leaving makeCircle"),o}function handleDragOver(e){return log.info("Entering handleDragOver"),e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="copy",log.info("Leaving handleDragOver"),!1}function handleDragEnter(){log.info("Entering handleDragEnter"),this.classList.add("over"),log.info("Leaving handleDragEnter")}function handleDragLeave(){log.info("Entering handleDragLeave"),this.classList.remove("over"),log.info("Leaving handleDragLeave")}function sendBackward(){log.info("Entering sendBackward");var e=canvas.getActiveObject();e&&canvas.sendBackwards(e),$("#glossymenu").remove(),contextmenuon=!1,activeObject=!1,log.info("Leaving sendBackward")}function sendToBack(){log.info("Entering sendToBack");var e=canvas.getActiveObject();e&&canvas.sendToBack(e),$("#glossymenu").remove(),contextmenuon=!1,activeObject=!1,log.info("Leaving sendToBack")}function bringFoward(){log.info("Entering bringFoward");var e=canvas.getActiveObject();e&&canvas.bringForward(e),$("#glossymenu").remove(),contextmenuon=!1,activeObject=!1,log.info("Leaving bringFoward")}function bringToFront(){log.info("Entering bringToFront");var e=canvas.getActiveObject();e&&canvas.bringToFront(e),$("#glossymenu").remove(),contextmenuon=!1,activeObject=!1,log.info("Leaving bringToFront")}function lineDown(e){log.info("Entering lineDown"),""!=handler&&document.removeEventListener("contextmenu",handler),3==e.e.which&&(handler=function(e){if(0==contextmenuon&&1==activeObject){e.preventDefault();var n=["Delete Line","Change Color","Send Backward","Send To Back","Bring Forward","Bring To Front"];menus(n,e),$('a:contains("Delete")').click(function(){null!=canvas.getActiveObject()&&(activeObjectVal=canvas.getActiveObject()),activeObjectVal.type&&("line"==activeObjectVal.type?(canvas.remove(activeObjectVal.c1),canvas.remove(activeObjectVal.c2),canvas.remove(activeObjectVal)):"lineGroup"==activeObjectVal.type&&(searchId=getItemIndex(activeObjectVal),canvas.setActiveObject(canvas.item(searchId)),canvas.getActiveGroup()?(canvas.getActiveGroup().forEachObject(function(e){canvas.remove(e)}),canvas.discardActiveGroup().renderAll(),lineActive=!1):(canvas.remove(canvas.getActiveObject()),lineActive=!1),canvas.renderAll())),$("#glossymenu").remove(),contextmenuon=!1,activeObject=!1}),$('a:contains("Change Color")').click(function(){activateColorPicker(e),$("#glossymenu").remove(),contextmenuon=!1}),$('a:contains("Send Backward")').click(function(){sendBackward()}),$('a:contains("Send To Back")').click(function(){sendToBack()}),$('a:contains("Bring Forward")').click(function(){bringFoward()}),$('a:contains("Bring To Front")').click(function(){bringToFront()}),contextmenuon=!0}},document.addEventListener("contextmenu",handler,!1)),log.info("Leaving lineDown")}function ellipseDown(e){log.info("Entering ellipseDown"),""!=handler&&document.removeEventListener("contextmenu",handler),3==e.e.which&&(handler=function(e){if(0==contextmenuon&&1==activeObject){e.preventDefault();var n=["Delete Ellipse","Change Color","Send Backward","Send To Back","Bring Forward","Bring To Front"];menus(n,e),$('a:contains("Delete")').click(function(){log.debug("ellipseDown: In Delete"),activeObjectVal=canvas.getActiveObject(),log.trace(activeObjectVal),canvas.remove(activeObjectVal),$("#glossymenu").remove(),contextmenuon=!1,activeObject=!1}),$('a:contains("Change Color")').click(function(){activateColorPicker(e),$("#glossymenu").remove(),contextmenuon=!1}),$('a:contains("Send Backward")').click(function(){sendBackward()}),$('a:contains("Send To Back")').click(function(){sendToBack()}),$('a:contains("Bring Forward")').click(function(){bringFoward()}),$('a:contains("Bring To Front")').click(function(){bringToFront()}),contextmenuon=!0}},document.addEventListener("contextmenu",handler,!1)),log.info("Leaving ellipseDown")}function circleDown(e){log.info("Entering circleDown"),""!=handler&&document.removeEventListener("contextmenu",handler),3==e.e.which&&(handler=function(e){if(0==contextmenuon&&1==activeObject){e.preventDefault();var n=["Delete Circle","Change Color","Send Backward","Send To Back","Bring Forward","Bring To Front"];menus(n,e),$('a:contains("Delete")').click(function(){log.debug("circleDown: In Delete"),activeObjectVal=canvas.getActiveObject(),log.trace(activeObjectVal),canvas.remove(activeObjectVal),$("#glossymenu").remove(),contextmenuon=!1,activeObject=!1}),$('a:contains("Change Color")').click(function(){activateColorPicker(e),$("#glossymenu").remove(),contextmenuon=!1}),$('a:contains("Send Backward")').click(function(){sendBackward()}),$('a:contains("Send To Back")').click(function(){sendToBack()}),$('a:contains("Bring Forward")').click(function(){bringFoward()}),$('a:contains("Bring To Front")').click(function(){bringToFront()}),contextmenuon=!0}},document.addEventListener("contextmenu",handler,!1)),log.info("Leaving circleDown")}function rectangleDown(e){log.info("Entering rectangleDown"),""!=handler&&document.removeEventListener("contextmenu",handler),3==e.e.which&&(handler=function(e){if(0==contextmenuon&&1==activeObject){e.preventDefault();var n=["Delete Rectangle","Change Color","Send Backward","Send To Back","Bring Forward","Bring To Front"];menus(n,e),$('a:contains("Delete")').click(function(){log.debug("rectangleDown: In Delete"),activeObjectVal=canvas.getActiveObject(),log.trace(activeObjectVal),canvas.remove(activeObjectVal),$("#glossymenu").remove(),contextmenuon=!1,activeObject=!1}),$('a:contains("Change Color")').click(function(){activateColorPicker(e),$("#glossymenu").remove(),contextmenuon=!1}),$('a:contains("Send Backward")').click(function(){sendBackward()}),$('a:contains("Send To Back")').click(function(){sendToBack()}),$('a:contains("Bring Forward")').click(function(){bringFoward()}),$('a:contains("Bring To Front")').click(function(){bringToFront()}),contextmenuon=!0}},document.addEventListener("contextmenu",handler,!1)),log.info("Leaving rectangleDown")}function textDown(e){log.info("Entering textDown"),""!=handler&&document.removeEventListener("contextmenu",handler),3==e.e.which&&(handler=function(e){if(0==contextmenuon&&1==activeObject){e.preventDefault();var n=["Delete Text","Change Color","Send Backward","Send To Back","Bring Forward","Bring To Front"];menus(n,e),$('a:contains("Delete")').click(function(){log.debug("textDown: In Delete"),activeObjectVal=canvas.getActiveObject(),log.trace(activeObjectVal),canvas.remove(activeObjectVal),$("#glossymenu").remove(),contextmenuon=!1,activeObject=!1}),$('a:contains("Change Color")').click(function(){activateColorPicker(e),$("#glossymenu").remove(),contextmenuon=!1}),$('a:contains("Send Backward")').click(function(){sendBackward()}),$('a:contains("Send To Back")').click(function(){sendToBack()}),$('a:contains("Bring Forward")').click(function(){bringFoward()}),$('a:contains("Bring To Front")').click(function(){bringToFront()}),contextmenuon=!0}}),document.addEventListener("contextmenu",handler,!1),log.info("Leaving textDown")}function imageDown(e){log.info("Entering imageDown"),""!=handler&&document.removeEventListener("contextmenu",handler),3==e.e.which&&(handler=function(e){if(0==contextmenuon&&1==activeObject){if(e.preventDefault(),log.trace("ActiveObjectVal: ",activeObjectVal),log.trace("Has configdbid property: ",activeObjectVal.hasOwnProperty("configdbid")),0!=activeObjectVal.configdbid)var n=["Configure","Delete Image","Send To Back","Send Backward","Bring Forward","Bring To Front"];else var n=["Delete Image","Send To Back","Send Backward","Bring Forward","Bring To Front"];menus(n,e),$('a:contains("Configure")').click(function(){var e=activeObjectVal.configdbid,n=1;searchId=getItemIndex(activeObjectVal),canvas.setActiveObject(canvas.item(searchId)),configuratorProduct2(e,n,searchId),$("#glossymenu").remove(),contextmenuon=!1,activeObject=!0}),$('a:contains("Delete")').click(function(){log.debug("imageDown: In Delete"),log.trace(activeObjectVal),canvas.remove(activeObjectVal),$("#glossymenu").remove(),contextmenuon=!1,activeObject=!1}),$('a:contains("Change Color")').click(function(){activateColorPicker(e)}),$('a:contains("Send Backward")').click(function(){sendBackward()}),$('a:contains("Send To Back")').click(function(){sendToBack()}),$('a:contains("Bring Forward")').click(function(){bringFoward()}),$('a:contains("Bring To Front")').click(function(){bringToFront()}),contextmenuon=!0}}),document.addEventListener("contextmenu",handler,!1),log.info("Leaving imageDown")}function handleDrop(e){log.info("Entering handleDrop");var n=document.querySelector("#images img.img_dragging");log.trace("Draggable Stage:",n);if(e.stopPropagation&&e.stopPropagation(),null!=n){var t=n.getAttribute("img_val");if(log.debug("imgsrc_val: ",t),"line.png"==t){log.debug("In line.png section"),objectName="line";var o=e.layerX,a=e.layerY,i=o+25,r=a+25,g=objId_var+3;objId=g;var l=makeLine([o,a,i,r],g);l.hasBorders=l.hasControls=!1,canvas.add(l),c[g]=makeCircle(l),l.c1=c[g][0],l.c2=c[g][1],l.id=itemId,itemId+=1,canvas.add(c[g][0],c[g][1]),l.on("mousedown",function(e,n){lineDown(e,n)})}else if("circle_icon.png"==t){log.debug("In circle_icon.png section"),objectName="circle";var o=e.layerX,a=e.layerY,g=objId_var+1;objId=g;var d=makeCircleShape([o,a],g);d.hasBorders=d.hasControls=!0,d.on("mousedown",function(e,n){circleDown(e,n)}),d.id=itemId,itemId+=1,canvas.add(d)}else if("ellipse_icon.png"==t){log.debug("In ellipse_icon.png section"),objectName="circle";var o=e.layerX,a=e.layerY,g=objId_var+1;objId=g;var s=makeEllipseShape([o,a],g);s.hasBorders=s.hasControls=!0,s.on("mousedown",function(e,n){ellipseDown(e,n)}),s.id=itemId,itemId+=1,canvas.add(s)}else if("rectangle-icon.png"==t){log.debug("In rectangle-icon.png section"),objectName="rectangle";var o=e.layerX,a=e.layerY,g=objId_var+1;objId=g;var u=makeRectangleShape([o,a],g);u.hasBorders=u.hasControls=!0,u.on("mousedown",function(e,n){rectangleDown(e,n)}),u.id=itemId,itemId+=1,canvas.add(u)}else if("textbox_icon.png"==t){log.debug("In textbox_icon.png section");var v=new fabric.IText("Tap and Type",{fontFamily:"arial black",fontSize:12,left:e.layerX,top:e.layerY});v.hasBorders=v.hasControls=!0,v.id=itemId,itemId+=1,canvas.add(v),v.on("mousedown",function(e,n){textDown(e,n)})}else{log.debug("In drag down else category");var f=new fabric.CustomImage(n,{width:n.width,height:n.height,left:e.layerX,top:e.layerY,config:"undefined"});n.hasAttribute("data-config")?(log.debug("Has data-config"),f.configdbid=n.getAttribute("data-config"),log.debug("data-config: ",f.configdbid)):f.configdbid=!1,n.hasAttribute("data-model")?(log.debug("Has data-model"),f.model=n.getAttribute("data-model"),log.debug("data-model: ",f.model)):f.model=!1,f.id=itemId,itemId+=1,canvas.add(f),f.on("mousedown",function(e,n){imageDown(e,n)})}return this.classList.remove("over"),!1}log.info("Leaving handleDrop")}function contextMenu(e){log.info("Entering contextMenu");var n=e.offsetX,t=e.offsetY;return $.each(canvas._objects,function(e,o){var a=o.width/2,i=o.height/2;return n>=o.left-a&&n<=o.left+a&&t>=o.top-i&&t<=o.top+i?!1:void 0}),log.info("Leaving contextMenu"),!1}function menus(e,n){for(log.info("Entering menus"),$("body").append("<div id='glossymenu' class='glossymenu'>"),$("#glossymenu").append("<ul id='ulglossymenu'>"),index=0;index<e.length;index++)$("#ulglossymenu").append("<li> <a>"+e[index]+"</a> </li>");$("#glossymenu").append("</ul>"),$("#body").append("</div>");var t=n.layerY+"px",o=n.layerX+"px";$("#glossymenu").css("top",t),$("#glossymenu").css("left",o),log.info("Leaving menus")}function handleDragEnd(){log.info("Entering handleDragEnd"),[].forEach.call(images,function(e){e.classList.remove("img_dragging")}),log.info("Leaving handleDragEnd")}function drawAsPNG(){return log.info("Entering drawAsPNG"),canvas.isDrawingMode=!1,window.localStorage?(window.open(canvas.toDataURL("png")),void log.info("Leaving drawAsPNG")):void alert("This function is not supported by your browser.")}function getItemIndex(e){for(log.info("Entering getItemIndex"),id=e.id,index=0,objectList=canvas.getObjects(),i=0;i<objectList.length;i++)objectList[i].id==id&&(index=i);return log.info("Leaving getItemIndex"),index}function configuratorProduct(e,n,t){log.info("Entering configuratorProduct"),popup=window.open("/companies/"+n+"/prices/"+e+"/productconfig.html?searchId="+t,"Popup","width=300,height=500"),popup.focus(),log.info("Leaving configuratorProduct")}function backgroundModal(){log.info("Entering backgroundModal"),$("#backgroundSection").modal("show"),log.info("Leaving backgroundModal")}function loadConfigScreen(e,n,t){if(jsondata=e,log.info("Entering loadConfigScreen"),log.trace("jsondata: ",jsondata),"Data Not Found"==jsondata.error)document.getElementById("data").innerHTML+="<br>"+jsondata.error;else{for(jsondataprice=JSON.parse(jsondata.price),document.getElementById("data").innerHTML+="<br>"+jsondata.name,i=0;i<jsondataprice.product.options.length;i++){var o=document.createElement("div");o.className="row";var a=document.createElement("div");a.className="col-sm-3",a.innerHTML+=jsondataprice.product.options[i].opname,o.appendChild(a);var c=document.createElement("div");c.className="col-sm-9";var r="",g="select"+i;for(r='<select id="'+g+'">',j=0;j<jsondataprice.product.options[i].selections.length;j++)r+='<option value=\'{"code":"',r+=jsondataprice.product.options[i].selections[j].code,r+='","price":"',r+=jsondataprice.product.options[i].selections[j].price,r+="\"}'",n&&jsondataprice.product.options[i].selections[j].code==t[i+1]&&(r+=' selected="selected" '),r+=">",r+=jsondataprice.product.options[i].selections[j].description,r+="</option>";r+="</select>",c.innerHTML+=r,o.appendChild(c),document.getElementById("data").appendChild(o)}for(configString(jsondata,searchId),log.debug("Adding Listeners: Before For Loop"),i=0;i<jsondataprice.product.options.length;i++){var g="select"+i;document.getElementById(g).onchange=function(){var e=this.selectedIndex,n=this.children[e].innerHTML.trim();log.trace(n),configString(jsondata,searchId)}}}$("#gifspinner").fadeOut(400),log.info("Leaving loadConfigScreen")}function configuratorProduct2(e,n,t){log.info("Entering configuratorProduct2"),$("#configsection").modal("show"),$("#gifspinner").show(),document.getElementById("data").innerHTML="";var o=!1,a="",i=canvas.item(t).config;void 0!=i&&(log.info("Object Config is Defined: ",i),o=!0,a=i.split("-"));var c="/companies/"+n+"/prices/"+e+"/productconfig.json",r="";$.ajax({url:c,type:"GET",dataType:"json",data:r,contentType:"application/json",timeout:3e3,complete:function(){$("#gifspinner").fadeOut(400),log.info("Ajax Call is Complete")},success:function(e){log.trace("configuratorProduct2: In Ajax Success"),loadConfigScreen(e,o,a),log.trace(e),configString(e,t),log.info("Ajax Call is Success"),log.trace("Ajax Call is Success")},error:function(e,n){log.trace(e),alert(n),log.info(n)}}),log.info("Leaving configuratorProduct2")}function configString(e,n){log.info("Entering configString"),log.trace("configString:jasontext",e),jsondataprice=JSON.parse(e.price),log.trace("configString:jsondataprice",jsondataprice);var t=jsondataprice.product.name,o=jsondataprice.product.basePrice;for(i=0;i<jsondataprice.product.options.length;i++){selectid="select"+i;var a=document.getElementById(selectid).selectedIndex;t+="-";var c=JSON.parse(document.getElementById(selectid).children[a].value);t+=c.code,o=parseInt(o)+parseInt(c.price)}document.getElementById("prodconfig").innerHTML=t,document.getElementById("price").innerHTML=o,SetConfig(n),log.info("Leaving configString")}function SetConfig(e){log.info("Entering SetConfig"),canvas.item(e).config=document.getElementById("prodconfig").innerHTML,canvas.item(e).price=document.getElementById("price").innerHTML,canvas.renderAll(),log.info("Leaving SetConfig")}var popup;