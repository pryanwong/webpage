function textChangedEvent(e){console.log("Text Change Event Fired"),$("#saveMessage").text("Changes Made, Save Pending..."),log.debug("text:changed",e.target,e),onSave()}function objectDeletedEvent(e){$("#saveMessage").text("Changes Made, Save Pending..."),log.debug("lineDeletedEvent",e.target,e),onSave()}function loadCanvasDrawing(e){""!=e&&(console.log("data_drawing not blank"),console.log(e),canvas.loadFromJSON(e,function(){canvas.renderAll.bind(canvas);var e=canvas.getObjects().map(function(e){return e.set("active",!1)});log.debug("Entering loop for objects"),log.debug("Loop size: ",e.length);var o=0;for(itemId=0,i=0;i<e.length;i++)log.debug("Objs Type: ",e[i].type),e[i].id=itemId,"customline"==e[i].type&&(e[i].hasControls=!1,log.debug("customline: ",e[i]),log.debug("Item Id of line set to: ",e[i].getObjId()),canvas.forEachObject(function(n){log.debug("Object Type: ",n.type),"circlezero"!=n.type&&"circleone"!=n.type||(log.debug("circleProspect.belongsTo: ",n.belongsTo),log.debug("objs[1].objId: ",e[i].objId)),"circlezero"==n.type&&n.belongsTo==e[i].objId&&(n.hasBorders=n.hasControls=!1,n.line=e[i],n.belongsTo=itemId,e[i].cone=n,n.set("hoverCursor","crosshair"),log.debug("found circlezero"),o+=1),"circleone"==n.type&&n.belongsTo==e[i].objId&&(n.hasBorders=n.hasControls=!1,n.line=e[i],n.belongsTo=itemId,e[i].ctwo=n,n.set("hoverCursor","crosshair"),log.debug("found circleone"),o+=1),2==o&&(log.debug("objId: ",e[i].get("objId")),e[i].setObjId(itemId),itemId+=1,e[i].cone.id=itemId,itemId+=1,e[i].ctwo.id=itemId,o=0)}),e[i].on("mousedown",function(e,o){lineDown(e,o)})),"customlinearrow"==e[i].type&&(e[i].hasControls=!1,log.debug("customline: ",e[i]),log.debug("Item Id of line set to: ",e[i].getObjId()),canvas.forEachObject(function(n){log.debug("Object Type: ",n.type),"carrow"!=n.type&&"conearrow"!=n.type||(log.debug("circleProspect.belongsTo: ",n.belongsTo),log.debug("objs[1].objId: ",e[i].objId)),"conearrow"==n.type&&n.belongsTo==e[i].objId&&(n.hasBorders=n.hasControls=!1,n.line=e[i],n.belongsTo=itemId,e[i].conearrow=n,n.set("hoverCursor","crosshair"),log.debug("found conearrow"),o+=1),"carrow"==n.type&&n.belongsTo==e[i].objId&&(n.hasBorders=n.hasControls=!1,n.line=e[i],n.belongsTo=itemId,e[i].carrow=n,n.set("hoverCursor","crosshair"),log.debug("found carrow"),o+=1),2==o&&(log.debug("objId: ",e[i].get("objId")),e[i].setObjId(itemId),itemId+=1,e[i].conearrow.id=itemId,itemId+=1,e[i].carrow.id=itemId,o=0)}),e[i].on("mousedown",function(e,o){customlinearrow.lineArrowDown(e,o)})),"customlinetwoarrow"==e[i].type&&(e[i].hasControls=!1,log.debug("customline: ",e[i]),log.debug("Item Id of line set to: ",e[i].getObjId()),canvas.forEachObject(function(n){log.debug("Object Type: ",n.type),"carrow"!=n.type&&"carrowtwo"!=n.type||(log.debug("circleProspect.belongsTo: ",n.belongsTo),log.debug("objs[1].objId: ",e[i].objId)),"carrowtwo"==n.type&&n.belongsTo==e[i].objId&&(n.hasBorders=n.hasControls=!1,n.line=e[i],n.belongsTo=itemId,e[i].carrowtwo=n,n.set("hoverCursor","crosshair"),log.debug("found carrowtwo"),o+=1),"carrow"==n.type&&n.belongsTo==e[i].objId&&(n.hasBorders=n.hasControls=!1,n.line=e[i],n.belongsTo=itemId,e[i].carrow=n,n.set("hoverCursor","crosshair"),log.debug("found carrow"),o+=1),2==o&&(log.debug("objId: ",e[i].get("objId")),e[i].setObjId(itemId),itemId+=1,e[i].carrowtwo.id=itemId,itemId+=1,e[i].carrow.id=itemId,o=0)}),e[i].on("mousedown",function(e,o){lineArrowTwoDown(e,o)})),itemId+=1;canvas.renderAll()},postProcessLoading))}function checkBackgroundFileExists(e){log.info("Entering checkBackgroundFileExists"),log.debug(e),console.log("Checkbackgroundfileexists: ",e),$.ajax({url:e,type:"HEAD",error:function(){return log.debug("In Error Function checkBackgroundFileExists"),log.debug("Background File Not Found"),!1},success:function(){return log.debug("In success Function checkBackgroundFileExists"),log.debug("Background File Exists"),!0}}),log.info("Leaving checkBackgroundFileExists")}var onSave=debounce(function(){log.info("Entering onSave"),modified=!0,$("#saveMessage").text("Save In Progress..."),objects=canvas.getObjects();var e=objects.length;log.debug("Number of objects to process: ",e),canvas.renderAll();var o=$('meta[name="csrf-token"]').attr("content");canvas.backgroundColor="";var n={company_id:company_id,user_id:user_id,id:drawing_id,authenticity_token:o,png:"",drawing:canvas};log.trace(n);var t="/companies/"+company_id+"/users/"+user_id+"/drawings/"+drawing_id+".json";$.ajax({url:t,type:"patch",dataType:"json",contentType:"application/json",data:JSON.stringify(n),timeout:3e3,complete:function(){},success:function(e){textMsg=JSON.parse(e[0]),log.debug("Text Msg: ",textMsg),$("#saveMessage").text(textMsg[0]),loadVersionsIntoPanel(e[1])},error:function(e,o){msg="Error: "+o,$("#saveMessage").text(msg)}}),log.info("Leaving onSave")},3e3);