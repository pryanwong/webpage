var lineobject=function(){};lineobject.makeLine=function(e,t){return log.info("Entering makeLine"),log.debug("Coords are: ",e),line=new fabric.Customline(e,{x1:e[0],y1:e[1],x2:e[2],y2:e[3],fill:"red",stroke:"red",strokeWidth:5,selectable:!0,objId:t,perPixelTargetFind:!0}),line.hasControls=!1,log.info("Leaving makeLine"),line},lineobject.setLinePositions=function(e){for(var t=e.target,n=(t.get("type"),t.get("objId")),o=_curX-e.e.clientX,c=_curY-e.e.clientY,i=0;i<canvas.getObjects().length;i++){var r=canvas.getObjects()[i];"circleone"==r.type&&r.get("belongsTo")==n&&(_c2Top=r.getTop(),_c2Left=r.getLeft(),r.set({left:r.left-o,top:r.top-c}),r.setCoords(),r.line&&r.line.set({x2:r.left,y2:r.top}),r.line.setCoords()),"circlezero"==r.type&&r.get("belongsTo")==n&&(_c1Top=r.getTop(),_c1Left=r.getLeft(),r.set({left:r.left-o,top:r.top-c}),r.setCoords(),r.line&&r.line.set({x1:r.left,y1:r.top}),r.line.setCoords())}_curX=e.e.clientX,_curY=e.e.clientY},lineobject.setLineCirclePositionsBoundary=function(e){var t=e.target;t.get("type"),t.get("objId"),_curX-e.e.clientX,_curY-e.e.clientY;_circleOne=t.cone,_circleTwo=t.ctwo,_circleTwo&&_circleTwo.set({left:_c2Left,top:_c2Top}),_circleTwo.setCoords(),_circleTwo.line&&_circleTwo.line.set({x2:_circleTwo.left,y2:_circleTwo.top}),_circleTwo.line.setCoords(),_circleOne&&_circleOne.set({left:_c1Left,top:_c1Top}),_circleOne.setCoords(),_circleOne.line&&_circleOne.line.set({x1:_circleOne.left,y1:_circleOne.top}),_circleOne.line.setCoords(),t&&t.set({x1:_circleOne.left,y1:_circleOne.top,x2:_circleTwo.left,y2:_circleTwo.top})},lineobject.objectBoundaryCheck=function(e){var t=!1;this.setLinePositions(e),log.info("Entering  objectBoundaryCheck"),$("#saveMessage").text("Changes Made, Save Pending..."),e.target.setCoords(),console.log("Object in boundary check: ",e.target),log.debug("Checking to see if the end points of a line are being dragged ");var n=e.target,o=e.target.getBoundingRect().top+e.target.getBoundingRect().height,c=e.target.getBoundingRect().left+e.target.getBoundingRect().width,i=n.getBoundingRect(),r=-(i.left-n.left),a=-(i.top-n.top);bounds={tl:{x:0,y:0},br:{x:canvas.width,y:canvas.height}},log.debug("Checking to see if we hit the top-left corner"),(e.target.getBoundingRect().top<=bounds.tl.y||e.target.getBoundingRect().left<=bounds.tl.x)&&(log.debug("hit the top-left corner"),e.target.setTop(Math.max(e.target.top,a)),e.target.left=Math.max(e.target.left,r),this.setLineCirclePositionsBoundary(e),canvas.deactivateAll(),t=!0,e.target.setCoords()),log.debug("Checking to see if we hit the bot-right corner"),(o>=bounds.br.y||c>=bounds.br.x)&&(o>=bounds.br.y&&(e.target.angle>=270&&e.target.angle<360?e.target.top=bounds.br.y-e.target.getBoundingRect().height+a:e.target.angle>=90&&e.target.angle<=180?(e.target.top=bounds.br.y-e.target.getBoundingRect().height+a,log.debug("Calculated Top: "+(bounds.br.y-e.target.getBoundingRect().height+a))):e.target.angle>180&&e.target.angle<270?e.target.top=bounds.br.y-e.target.getBoundingRect().height+a:e.target.angle>=0&&e.target.angle<90&&(e.target.top=bounds.br.y-e.target.getBoundingRect().height+a)),c>=bounds.br.x&&(e.target.angle>=270&&e.target.angle<360?e.target.left=bounds.br.x-e.target.getBoundingRect().width:e.target.angle>=90&&e.target.angle<=180?e.target.left=bounds.br.x:e.target.angle>180&&e.target.angle<270?e.target.left=bounds.br.x-e.target.getBoundingRect().width+r:e.target.angle>=0&&e.target.angle<90&&(e.target.left=bounds.br.x-e.target.getBoundingRect().width+r)),t=!0,this.setLineCirclePositionsBoundary(e),canvas.deactivateAll(),e.target.setCoords()),onSave(),log.info("Leaving objectBoundaryCheck")},lineobject.objectSelected=function(e){log.info("Entering objectSelected"),activeObject=!0,activeObjectVal=e.target,console.log("objectSelected: ",activeObjectVal);e.target.get("type");console.log("custom line selected"),_curX=e.e.clientX,_curY=e.e.clientY,_c1Top=e.target.cone.getTop(),_c1Left=e.target.cone.getLeft(),_c2Top=e.target.ctwo.getTop(),_c2Left=e.target.ctwo.getLeft()},lineobject.lineDown=function(e){log.info("Entering lineDown"),console.log("Entering lineDown"),console.log("data: ",e),activeObjectVal&&(activeObject=!0),""!==handler&&document.removeEventListener("contextmenu",handler),3==e.e.which&&(handler=function(e){if(contextmenuon===!1&&activeObject===!0){e.preventDefault();var t=["Delete Line","Change Color","Send Backward","Send To Back","Bring Forward","Bring To Front"];menus(t,e),$('a:contains("Delete")').click(function(){if(activeObjectVal.type)if("customline"==activeObjectVal.type)canvas.remove(activeObjectVal.cone),canvas.remove(activeObjectVal.ctwo),canvas.remove(activeObjectVal);else if(activeObjectVal.hasOwnProperty("belongsTo")){console.log("removing belongTo object");for(var e=canvas.getObjects(),t=activeObjectVal.get("belongsTo"),n=!1,o=0;!n&&o<e.length;)"customline"==e[o].type&&e[o].objId==t&&(n=!0),o+=1;n&&(o-=1,canvas.remove(e[o].cone),canvas.remove(e[o].ctwo),canvas.remove(e[o])),canvas.renderAll()}$("#contextMenu").remove(),contextmenuon=!1,activeObject=!1}),$('a:contains("Change Color")').click(function(){activateColorPicker(e),$("#contextMenu").remove(),contextmenuon=!1}),$('a:contains("Send Backward")').click(function(){sendBackward()}),$('a:contains("Send To Back")').click(function(){sendToBack()}),$('a:contains("Bring Forward")').click(function(){bringFoward()}),$('a:contains("Bring To Front")').click(function(){bringToFront()}),contextmenuon=!0}},document.addEventListener("contextmenu",handler,!1)),log.info("Leaving lineDown")},lineobject.lineDrop=function(e,t){objectName="customline";var n=e.layerX,o=e.layerY,i=n+25,r=o+25;objId=t,line=lineobject.makeLine([n,o,i,r],t),line.hasControls=!1,itemId+=1,line.id=itemId,line.objId=itemId,canvas.add(line),c[t]=lineobject.makeCircle(line),line.cone=c[t][0],line.ctwo=c[t][1],console.log("Line coords: ",line.get("x1"),line.get("y1"),line.get("x2"),line.get("y2")),canvas.add(c[t][0],c[t][1]),canvas.renderAll(),line.on("mousedown",function(e,t){lineDown(e,t)})},lineobject.makeCircle=function(e){log.info("Entering makeCircle");var t=new fabric.Circlezero({left:e.get("x1")-2.5,top:e.get("y1")-2.5,visible:"true",hoverCursor:"crosshair",strokeWidth:2,stroke:"#000",radius:5,fill:"#fff"});t.setBelongsTo(e.objId);var n=new fabric.Circleone({left:e.get("x2")-2.5,top:e.get("y2")-2.5,visible:"true",hoverCursor:"crosshair",strokeWidth:2,stroke:"#000",radius:5,fill:"#fff"});n.setBelongsTo(e.objId),t.hasBorders=t.hasControls=!1,n.hasBorders=n.hasControls=!1,t.line=e,n.line=e,e.cone=t,e.ctwo=n;var o=new Array(t,n);return log.info("Leaving makeCircle"),o};