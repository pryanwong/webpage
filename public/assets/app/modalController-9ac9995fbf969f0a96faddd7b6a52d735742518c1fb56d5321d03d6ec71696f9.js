angular.module("app").controller("ModalController",["$uibModal","$log","$document","$scope",function(n,e,a){function o(o,i){var l=i?angular.element(a[0].querySelector(".modal-demo "+i)):void 0;console.log(l),console.log("In open");var s=n.open({animation:t.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"fileUploadContent.html",controller:"ModalInstanceCtrl",controllerAs:"mc",size:o,appendTo:l});s.result.then(function(){},function(){e.info("Modal dismissed at: "+new Date)})}var t=this;t.open=o,t.animationsEnabled=!0,t.init=function(n,e,a){t.company_id=n,t.user_id=e,t.drawing_id=a},t.actionLink=function(){return val="/companies/"+t.company_id+"/users/"+t.user_id+"/drawings/"+t.drawing_id+"/updateBackground",val},t.closeModal=function(){$("backgroundButtonText").html("Background"),t.cancel()},t.openComponentModal=function(){var e=n.open({animation:t.animationsEnabled,component:"modalComponent"});e.result.then(function(n){t.selected=n},function(){})},t.toggleAnimation=function(){t.animationsEnabled=!t.animationsEnabled}}]),angular.module("app").controller("ModalInstanceCtrl",["$scope","$uibModalInstance",function(n,e){var a=this;a.load=function(){console.log("Running load inside ModalInstanceCtrl"),$(function(){$(".directUpload").find("input:file").each(function(n,e){console.log("URL directUpload"),log.debug(t);var o=$(e);log.debug("fileInput"),log.trace(o);var t=$(o.parents("form:first")),i=(t.data("url")+"/"+t.data("form-data").key,$("#submitButton")),l=$("#bar");l.css("display","none"),l.css("display","inline"),o.fileupload({add:function(n,e){var a=[],o=/^image\/(gif|jpe?g|png)$/i;e.originalFiles[0].type.length&&!o.test(e.originalFiles[0].type)&&a.push("Not an accepted file type"),e.originalFiles[0].size.length&&e.originalFiles[0].size>1e6&&a.push("Filesize is too big"),a.length>0?alert(a.join("\n")):e.submit()},fileInput:o,url:t.data("url"),type:"POST",autoUpload:!0,formData:t.data("form-data"),paramName:"file",dataType:"XML",replaceFileInput:!1,progressall:function(n,e){var a=parseInt(e.loaded/e.total*100,10);$("#progress").show(),l.text(a+"%"),l.attr("value",a)},start:function(){l.addClass("progress-success"),log.trace(t)},done:function(n,e){$("#saveMessage").text("Changes Made, Save Pending..."),i.prop("disabled",!1),$("#upload_button").removeAttr("disabled");var l=$(e.jqXHR.responseXML).find("Key").text(),s="//"+t.data("host")+"/"+l;log.debug("done:key,url"),log.debug(l),log.debug(s);var d=$("<input />",{type:"hidden",name:o.attr("name"),value:s});t.append(d),imageURL="https:"+s,log.debug("imageURL"),log.debug(imageURL),canvas.setBackgroundImage(imageURL,canvas.renderAll.bind(canvas),{backgroundImageOpacity:.5,backgroundImageStretch:!1,scaleX:1,scaleY:1,top:center.top,left:center.left,originX:"center",originY:"center",crossOrigin:"anonymous"}),$("#progress").hide(),a.cancelWithBackground(),onSave()},fail:function(){i.prop("disabled",!1),l.removeClass("progress-success").addClass("progress-danger")}})})})},a.ok=function(){e.close(a.selected.item)},a.cancelWithBackground=function(){$("#backgroundButtonText").html("Remove Background"),e.dismiss("cancel")},a.cancel=function(){$("#backgroundButtonText").html("Background"),e.dismiss("cancel")}}]),angular.module("app").component("modalComponent",{templateUrl:"fileUploadContent.html",bindings:{resolve:"<",close:"&",dismiss:"&"},controller:function(){var n=this;n.$onInit=function(){},n.ok=function(){},n.cancel=function(){n.dismiss({$value:"cancel"})}}});