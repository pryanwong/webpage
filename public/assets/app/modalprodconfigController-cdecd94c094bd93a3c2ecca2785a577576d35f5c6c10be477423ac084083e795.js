angular.module("app").controller("ModalProductConfigController",["$uibModal","$compile","$log","$document","$scope",function(o,e,n,c,t){function a(e,a,i,r,p,d,l,u){var m=u?angular.element(c[0].querySelector(".product-config-modal"+u)):void 0;console.log(m),console.log("In open"),s.product_id=a,s.company_id=e,s.selectChoices=i,s.splitVals=r,s.searchId=p,s.canvas=d,console.log("In open-: ",e,":",a),console.log("company, product: ",e,":",a),console.log("$scope: ",t);var j=o.open({animation:s.animationsEnabled,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"productConfigTmpl.html",controller:"ModalProductConfigInstanceCtrl",controllerAs:"mpc",scope:t,size:l,appendTo:m,resolve:{jsondata:function(){return s.jsondata}}});j.result.then(function(){},function(){n.info("Modal dismissed at: "+new Date)})}var s=this;s.open=a,s.company_id="",s.product_id="",s.jsondata="",s.animationsEnabled=!0,s.init=function(o,e){s.company_id=o,s.product_id=e},s.deleteAction="",s.configureAction="",s.menuFn=function(o,e){s.menus(o,e,"false")},s.selectedOption=function(o,e,n,c){var t="";return c&&o==n[e+1]&&(t="selected"),t},s.menus=function(o,n,c){textmenu=c,console.log('"'+o.join('","')+'"'),console.log(n.pageX),console.log(n.pageY),$("#mpc_holder").append(e('<contextmenu id="contextMenu" textmenu="'+textmenu+'" configureobj="mpc.configureAction()" deleteobj="mpc.deleteAction()" style="display:block;left:'+n.pageX+"px;top:"+n.pageY+'px" items="[\''+o.join("','")+'\']" x="'+n.pageX+'" y="'+n.pageY+'"></contextmenu>')(t))},s.closeModal=function(){s.cancel()},s.openComponentModal=function(){var e=o.open({animation:s.animationsEnabled,component:"modalProdcutConfigComponent",resolve:{jsondata:function(){return s.jsondata}}});e.result.then(function(o){s.selected=o},function(){})},s.toggleAnimation=function(){s.animationsEnabled=!s.animationsEnabled}}]),angular.module("app").controller("ModalProductConfigInstanceCtrl",["$window","$scope","$uibModalInstance","productConfigHub",function(o,e,n,c){var t=this;t.jsondata="test2",t.jsonObjerror="false",t.company_id=e.$parent.mpc.company_id,t.product_id=e.$parent.mpc.product_id,t.selectChoices=e.$parent.mpc.selectChoices,t.splitVals=e.$parent.mpc.splitVals,t.searchId=e.$parent.mpc.searchId,t.canvas=e.$parent.mpc.canvas,t.version="",t.selection={value:null},t.jsondata=c.getProductConfig({company_id:t.company_id,id:t.product_id}),t.jsondata.$promise.then(function(o){t.jsondata=o,console.log(o),t.jsondataprice=JSON.parse(t.jsondata.price);var e=t.jsondataprice.product.options.length;t.version=JSON.parse(t.jsondata.version),t.jsondataprice.product.price=parseFloat(t.jsondataprice.product.basePrice),console.log("Base Price: ",t.jsondataprice.product.price);for(var n=0;n<e;n++){var c=t.jsondataprice.product.options[n].selections.length;t.jsondataprice.product.options[n].value=t.jsondataprice.product.options[n].selections[0].value,t.jsondataprice.product.options[n].selectedValue={},t.jsondataprice.product.options[n].selectedValue.code=t.jsondataprice.product.options[n].selections[0].code,t.jsondataprice.product.options[n].selectedValue.price=t.jsondataprice.product.options[n].selections[0].price,t.jsondataprice.product.options[n].selectedValue.description=t.jsondataprice.product.options[n].selections[0].description,t.jsondataprice.product.price+=parseFloat(t.jsondataprice.product.options[n].selections[0].price),console.log("List Price Outside: ",t.jsondataprice.product.options[n].selectedValue.code,"-",t.jsondataprice.product.price);for(var a=0;a<c;a++)console.log("selectChoices",t.selectChoices),t.selectChoices&&(console.log("Splitvals: ",t.splitVals[n+1]),console.log("Code: ",t.jsondataprice.product.options[n].selections[a].code),t.jsondataprice.product.options[n].selections[a].code==t.splitVals[n+1]&&(t.jsondataprice.product.options[n].selectedValue.code=t.jsondataprice.product.options[n].selections[a].code,t.jsondataprice.product.options[n].selectedValue.price=t.jsondataprice.product.options[n].selections[a].price,t.jsondataprice.product.options[n].selectedValue.description=t.jsondataprice.product.options[n].selections[a].description,0!=a&&(t.jsondataprice.product.price-=parseFloat(t.jsondataprice.product.options[n].selections[0].price),t.jsondataprice.product.price+=parseFloat(t.jsondataprice.product.options[n].selections[a].price),console.log("List Price SelectedChoices: ",t.jsondataprice.product.options[n].selectedValue.code,"-",t.jsondataprice.product.price))))}console.log(t.jsondataprice),t.jsonObjerror=!1},function(){t.jsonObjerror=!0,console.log("Error")}),t.change=function(o,e){console.log("New Value: ",o),console.log("Old Value: ",e),t.jsondataprice.product.price-=parseFloat(e.price),t.jsondataprice.product.price+=parseFloat(o.price)},t.load=function(){console.log("Running load inside ModalProductConfigInstanceCtrl")},t.ok=function(){var o=t.jsondataprice.product.name,e=t.jsondataprice.product.options.length;console.log(o);for(var c=0;c<e;c++)o+="-"+t.jsondataprice.product.options[c].selectedValue.code,console.log(o);console.log("Canvas:",t.canvas),console.log("Search Id:",t.searchId),console.log("Item:",canvas.item(t.searchId)),t.canvas.item(t.searchId).price=t.jsondataprice.product.price,t.canvas.item(t.searchId).priceversion=t.version,t.canvas.item(t.searchId).setConfig(o),console.log("Object Price Change: ",t.canvas.item(t.searchId)),canvas.renderAll(),n.dismiss("cancel")},t.cancel=function(){n.dismiss("cancel")},t.reset=function(){t.canvas.item(t.searchId).price="",t.canvas.item(t.searchId).setConfig("undefined"),t.canvas.renderAll(),n.dismiss("cancel")}}]),angular.module("app").component("modalProdcutConfigComponent",{templateUrl:"productConfigTmpl.html",bindings:{resolve:"<",close:"&",dismiss:"&"},controller:function(){var o=this;o.$onInit=function(){o.jsondata=o.resolve.jsondata},o.ok=function(){},o.cancel=function(){o.dismiss({$value:"cancel"})}}});