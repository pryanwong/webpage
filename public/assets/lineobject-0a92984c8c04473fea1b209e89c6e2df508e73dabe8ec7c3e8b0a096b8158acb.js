var offX=-5,offY=-5,lineobject=function(e,t){};lineobject.makeLine=function(e,t){return log.info("Entering makeLine"),log.debug("Coords are: ",e),this.id=t,line=new fabric.Customline(e,{x1:e[0],y1:e[1],x2:e[2],y2:e[3],fill:"black",stroke:"black",strokeWidth:5,selectable:!0,objId:t,perPixelTargetFind:!0}),line.hasControls=!1,log.info("Leaving makeLine"),line},lineobject.setLinePositions=function(e){for(var t=e.target,n=(t.get("type"),t.get("objId")),o=_curX-e.e.clientX,r=_curY-e.e.clientY,i=0;i<canvas.getObjects().length;i++){var c=canvas.getObjects()[i];"circleone"==c.type&&c.get("belongsTo")==n&&(_c2Top=c.getTop(),_c2Left=c.getLeft(),c.set({left:c.left-o,top:c.top-r}),c.setCoords(),c.line&&c.line.set({x2:c.left,y2:c.top}),c.line.setCoords()),"circlezero"==c.type&&c.get("belongsTo")==n&&(_c1Top=c.getTop(),_c1Left=c.getLeft(),c.set({left:c.left-o,top:c.top-r}),c.setCoords(),c.line&&c.line.set({x1:c.left,y1:c.top}),c.line.setCoords())}_curX=e.e.clientX,_curY=e.e.clientY},lineobject.setLineCirclePositionsBoundary=function(e){var t=e.target;t.get("type"),t.get("objId"),_curX-e.e.clientX,_curY-e.e.clientY;_circleOne=t.cone,_circleTwo=t.ctwo,_circleTwo&&_circleTwo.set({left:_c2Left,top:_c2Top}),_circleTwo.setCoords(),_circleTwo.line&&_circleTwo.line.set({x2:_circleTwo.left,y2:_circleTwo.top}),_circleTwo.line.setCoords(),_circleOne&&_circleOne.set({left:_c1Left,top:_c1Top}),_circleOne.setCoords(),_circleOne.line&&_circleOne.line.set({x1:_circleOne.left,y1:_circleOne.top,originX:"center",originY:"center"}),_circleOne.line.setCoords(),t&&t.set({x1:_circleOne.left+offX,y1:_circleOne.top+offX,x2:_circleTwo.left+offX,y2:_circleTwo.top+offX})},lineobject.objectBoundaryCheck=function(e){var t=!1;this.setLinePositions(e),log.info("Entering  objectBoundaryCheck"),$("#saveMessage").text("Changes Made, Save Pending..."),e.target.setCoords(),log.debug("Checking to see if the end points of a line are being dragged ");var n=e.target,o=e.target.getBoundingRect().top+e.target.getBoundingRect().height,r=e.target.getBoundingRect().left+e.target.getBoundingRect().width,i=n.getBoundingRect(),c=-(i.left-n.left),l=-(i.top-n.top);bounds={tl:{x:0,y:0},br:{x:canvas.width,y:canvas.height}},log.debug("Checking to see if we hit the top-left corner"),(e.target.getBoundingRect().top<=bounds.tl.y||e.target.getBoundingRect().left<=bounds.tl.x)&&(log.debug("hit the top-left corner"),e.target.setTop(Math.max(e.target.top,l)),e.target.left=Math.max(e.target.left,c),this.setLineCirclePositionsBoundary(e),canvas.deactivateAll(),t=!0,e.target.setCoords()),log.debug("Checking to see if we hit the bot-right corner"),(o>=bounds.br.y||r>=bounds.br.x)&&(o>=bounds.br.y&&(e.target.angle>=270&&e.target.angle<360?e.target.top=bounds.br.y-e.target.getBoundingRect().height+l:e.target.angle>=90&&e.target.angle<=180?(e.target.top=bounds.br.y-e.target.getBoundingRect().height+l,log.debug("Calculated Top: "+(bounds.br.y-e.target.getBoundingRect().height+l))):e.target.angle>180&&e.target.angle<270?e.target.top=bounds.br.y-e.target.getBoundingRect().height+l:e.target.angle>=0&&e.target.angle<90&&(e.target.top=bounds.br.y-e.target.getBoundingRect().height+l)),r>=bounds.br.x&&(e.target.angle>=270&&e.target.angle<360?e.target.left=bounds.br.x-e.target.getBoundingRect().width:e.target.angle>=90&&e.target.angle<=180?e.target.left=bounds.br.x:e.target.angle>180&&e.target.angle<270?e.target.left=bounds.br.x-e.target.getBoundingRect().width+c:e.target.angle>=0&&e.target.angle<90&&(e.target.left=bounds.br.x-e.target.getBoundingRect().width+c)),t=!0,this.setLineCirclePositionsBoundary(e),canvas.deactivateAll(),e.target.setCoords()),onSave(),log.info("Leaving objectBoundaryCheck")},lineobject.objectSelected=function(e){log.info("Entering objectSelected"),activeObject=!0,activeObjectVal=e.target;e.target.get("type");_curX=e.e.clientX,_curY=e.e.clientY,_c1Top=e.target.cone.getTop(),_c1Left=e.target.cone.getLeft(),_c2Top=e.target.ctwo.getTop(),_c2Left=e.target.ctwo.getLeft()},lineobject.lineDown=function(e,t){log.info("Entering lineDown"),activeObjectVal&&(activeObject=!0),""!==handler&&document.removeEventListener("contextmenu",handler),3==e.e.which&&(console.log("In Line Down view index: ",t),console.log("Data:",e),handler=function(t){if(contextmenuon===!1&&activeObject===!0){t.preventDefault();var n=["Delete","Change Color","Send Backward","Send To Back","Bring Forward","Bring To Front"];angular.element(document.querySelector('[ng-controller="ModalProductConfigController as mpc"]')).scope().mpc.deleteAction=function(){console.log("Line ID: ",searchId);var e=getItemByIndex(searchId);if(e.type)if("customline"==e.type)canvas.remove(e.cone),canvas.remove(e.ctwo),canvas.remove(e);else if(e.hasOwnProperty("belongsTo")){for(var t=canvas.getObjects(),n=e.get("belongsTo"),o=!1,r=0;!o&&r<t.length;)"customline"==t[r].type&&t[r].objId==n&&(o=!0),r+=1;o&&(r-=1,canvas.remove(t[r].cone),canvas.remove(t[r].ctwo),canvas.remove(t[r])),canvas.renderAll()}$("#contextMenu").remove(),contextmenuon=!1,activeObject=!1},console.log("Line ID: ",this.id),updateSearchId(e),linemenus(n,t),contextmenuon=!0}},document.addEventListener("contextmenu",handler,!1)),log.info("Leaving lineDown")},lineobject.lineDrop=function(e,t){objectName="customline";var n=e.layerX,o=e.layerY,r=n+25,i=o+25;objId=t,line=lineobject.makeLine([n,o,r,i],t),line.hasControls=!1,itemId+=1,line.id=itemId,line.objId=itemId,itemId+=1,canvas.add(line),c[t]=lineobject.makeCircle(line),line.cone=c[t][0],line.ctwo=c[t][1],canvas.add(c[t][0],c[t][1]),canvas.renderAll(),line.on("mousedown",function(e,t){lineDown(e,t)})},lineobject.makeCircle=function(e){log.info("Entering makeCircle");var t=new fabric.Circlezero({left:e.get("x1"),top:e.get("y1"),visible:"true",hoverCursor:"crosshair",strokeWidth:5,stroke:"rgba(0,0,0,0)",radius:4,fill:"rgba(0,0,0,0)",originX:"center",originY:"center"});t.setBelongsTo(e.objId);var n=new fabric.Circleone({left:e.get("x2"),top:e.get("y2"),visible:"true",hoverCursor:"crosshair",strokeWidth:2,stroke:"rgba(0,0,0,0)",radius:4,fill:"rgba(0,0,0,0)",originX:"center",originY:"center"});n.setBelongsTo(e.objId),t.hasBorders=t.hasControls=!1,n.hasBorders=n.hasControls=!1,t.line=e,n.line=e,e.cone=t,e.ctwo=n;var o=new Array(t,n);return log.info("Leaving makeCircle"),o};